<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>KORE Mobiles — Admin Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet"/>

<style>
:root{--blue:#007bff;--green:#28a745;--red:#dc3545;--bg:#f7f9fc}
body{font-family:Poppins,sans-serif;margin:0;background:var(--bg)}
#loginBox{max-width:360px;margin:80px auto;background:#fff;padding:25px;border-radius:14px;box-shadow:0 8px 25px rgba(0,0,0,.15);text-align:center}
#loginBox input,#loginBox button{width:100%;padding:10px;margin-top:8px;border-radius:8px}
#loginBox button{background:var(--blue);border:none;color:#fff;font-weight:600}
#adminSection{display:none}
.wrap{max-width:1000px;margin:18px auto;padding:14px}
.header{display:flex;justify-content:space-between;align-items:center}
.btn{padding:8px 14px;border-radius:8px;border:none;font-weight:600;cursor:pointer}
.primary{background:var(--blue);color:#fff}
.logout{background:var(--red);color:#fff}
.layout{display:grid;grid-template-columns:1fr 420px;gap:14px}
.panel{background:#fff;border-radius:12px;padding:12px}
table{width:100%;border-collapse:collapse}
td,th{padding:8px;border-bottom:1px solid #eee;font-size:.9rem}
input{width:100%;padding:8px;margin-top:4px;border-radius:8px;border:1px solid #ccc}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox">
  <h2>Admin Login</h2>
  <input id="loginEmail" type="email" placeholder="Email">
  <input id="loginPass" type="password" placeholder="Password">
  <button id="loginBtn">Login</button>
  <p id="loginMsg" style="color:red"></p>
</div>

<!-- DASHBOARD -->
<div id="adminSection">
<div class="wrap">

<div class="header">
  <h2>⚙️ Admin Dashboard</h2>
  <div>
    <button class="btn primary" onclick="showPanel('modelsPanel')">Models</button>
    <button class="btn primary" onclick="showPanel('usersPanel')">Users</button>
    <button class="btn logout" id="logoutBtn">Logout</button>
  </div>
</div>

<!-- MODELS PANEL (unchanged logic) -->
<div id="modelsPanel" class="layout">
  <div class="panel">
    <h3>Models</h3>
    <table>
      <thead><tr><th>Name</th><th>MOP</th><th>DP</th></tr></thead>
      <tbody id="modelsTbody"></tbody>
    </table>
  </div>
  <div class="panel">
    <h3>Add Model</h3>
    <input id="m_name" placeholder="Name">
    <input id="m_mop" type="number" placeholder="MOP">
    <input id="m_dp" type="number" placeholder="DP">
    <button class="btn primary" id="saveModelBtn">Save</button>
  </div>
</div>

<!-- USERS PANEL -->
<div id="usersPanel" class="layout" style="display:none">
  <div class="panel">
    <h3>Users</h3>
    <table>
      <thead><tr><th>Email</th><th>Name</th><th>Action</th></tr></thead>
      <tbody id="usersTbody"></tbody>
    </table>
  </div>

  <div class="panel">
    <h3>Add User</h3>
    <input id="u_name" placeholder="Name">
    <input id="u_email" type="email" placeholder="Email">
    <input id="u_pass" type="password" placeholder="Password">
    <button class="btn primary" id="saveUserBtn">Create User</button>
  </div>
</div>

</div>
</div>

<!-- Firebase Compat -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
/* ---------- Firebase Init ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyByEiFSbsDlrCtVJjZgvbCoYPt_io2CpTk",
  authDomain: "nlcalulator.firebaseapp.com",
  projectId: "nlcalulator",
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

/* SECONDARY APP (FOR USER CREATION) */
const secondaryApp = firebase.initializeApp(firebaseConfig, "secondary");
const secondaryAuth = secondaryApp.auth();

const ADMIN_EMAIL = "anvirambhiya@gmail.com";

/* ---------- LOGIN ---------- */
loginBtn.onclick = async () => {
  try {
    await auth.signInWithEmailAndPassword(loginEmail.value, loginPass.value);
    if(auth.currentUser.email !== ADMIN_EMAIL){
      await auth.signOut();
      loginMsg.textContent = "Not admin";
    }
  } catch(e){ loginMsg.textContent = e.message }
};

logoutBtn.onclick = () => auth.signOut();

auth.onAuthStateChanged(u=>{
  if(u && u.email===ADMIN_EMAIL){
    loginBox.style.display="none";
    adminSection.style.display="block";
    loadUsers();
  }else{
    adminSection.style.display="none";
    loginBox.style.display="block";
  }
});

/* ---------- USERS ---------- */
async function loadUsers(){
  usersTbody.innerHTML="";
  const snap = await db.collection("users").get();
  snap.forEach(d=>{
    const u=d.data();
    usersTbody.innerHTML+=`<tr>
      <td>${u.email}</td>
      <td>${u.name}</td>
      <td><button onclick="deleteUser('${d.id}')">Delete</button></td>
    </tr>`;
  });
}

async function deleteUser(id){
  if(confirm("Delete user?")){
    await db.collection("users").doc(id).delete();
    loadUsers();
  }
}

saveUserBtn.onclick = async () => {
  const name=u_name.value.trim();
  const email=u_email.value.trim();
  const pass=u_pass.value.trim();

  if(!name||!email||!pass) return alert("Fill all fields");

  try{
    const cred = await secondaryAuth.createUserWithEmailAndPassword(email,pass);

    await db.collection("users").add({
      uid: cred.user.uid,
      name,
      email,
      role: "user",
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });

    alert("User created");
    u_name.value=u_email.value=u_pass.value="";
    loadUsers();
  }catch(e){ alert(e.message) }
};

/* ---------- UI ---------- */
function showPanel(id){
  modelsPanel.style.display="none";
  usersPanel.style.display="none";
  document.getElementById(id).style.display="grid";
}
</script>

</body>
</html>
